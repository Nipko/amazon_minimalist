--- Comment by luanstartflow ---
@propiter Are you using coexistence? I'm experiencing the same issue, and it started at exactly the same time you mentioned.

--- Comment by git100-br ---
Estou enfrentando o mesmo problema. NÃ£o uso coexistÃªncia. AlguÃ©m mais?

--- Comment by luanstartflow ---
@git100-br o que acontece com o seu? as mensagens chegam atrasadas?

--- Comment by websmark10 ---
Tengo el mismo problema , mi automatizaciÃ³n con en api de Whatsapp no contesta un promedio de 1 de cada 10 mensajes, chatwoot no registra el mensaje pero es porque no se lo envia Meta ,  por ende no se refleja ninguna ejecuciÃ³n en n8n , cuando vuelve uno a ingresar la opciÃ³n y el bot ahora si contesta... varias horas despues que ya no requerimos esos mensajes es cuando  llegan , como si hubieran estado atorados en Meta. 

Cabe mencionar que en los demas canales no se presenta esta situaciÃ³n , solo en para Whatsapp!!!

![Image](https://github.com/user-attachments/assets/fefc90ba-f6f6-49b1-92c3-96d3da615744)
![Image](https://github.com/user-attachments/assets/a01dd7b6-f9c2-4711-b782-e0f0c63ccd10)

--- Comment by luanstartflow ---
@websmark10 you are using Coexistence WhatsApp?

--- Comment by websmark10 ---
> [@websmark10](https://github.com/websmark10) you are using Coexistence WhatsApp?

NO , Yo no utilizo coexistencia,   solo utilizo  el webhook de chatwoot que es el que pongo en la configuracion del api de whatsapp con el campo messages suscrito. 

--- Comment by git100-br ---
Boa tarde, sim o meu algumas mensagens chegavam muito atrasadas e outras no tempo certo. GraÃ§as a Deus ğŸ™ conseguiu resolver. Era problema de DNS algum servidor deve estar bugado. Liguei o proxy da cloudflare no domÃ­nio d webhook e funcionou perfeitamente. Mandei uma sequÃªncia de 20 mensagens e todas entraram perfeitamente. GraÃ§as a Deus.

Uso VPS da Hostinger

--- Comment by luanstartflow ---
@git100-br obrigado, irei testar e volto para avisar.


--- Comment by git100-br ---
### **TÃ­tulo:** [SoluÃ§Ã£o] Mensagens da WhatsApp Cloud API atrasadas por horas ou perdidas (Erro Cloudflare WAF 418/428)

O Problema:
EstÃ¡vamos enfrentando problemas graves com os webhooks da WhatsApp Cloud API. As mensagens estavam chegando com horas de atraso.
Inicialmente, suspeitamos das filas do Sidekiq do Chatwoot, latÃªncia do AWS S3, limites de requisiÃ§Ã£o do Rack::Attack ou instabilidade global na API da Meta. O ambiente do servidor (VPS Hostinger) estava perfeito e as filas do Sidekiq estavam vazias.

A Causa Raiz:
O problema estava totalmente fora do cÃ³digo do Chatwoot. Foi um bloqueio silencioso pelo WAF (Web Application Firewall) do Cloudflare na porta de entrada do servidor.
A proteÃ§Ã£o contra bots do Cloudflare estava identificando as requisiÃ§Ãµes de webhook da Meta (e os robÃ´s de leitura da Meta) como trÃ¡fego estrangeiro suspeito, bloqueando-os com erros HTTP 418 / 428.
Como o Chatwoot nunca recebia a requisiÃ§Ã£o para devolver o 200 OK, os servidores da Meta colocavam os webhooks na "Fila de Tentativas" (Exponential Backoff), fazendo com que as mensagens fossem entregues horas depois.

A SoluÃ§Ã£o:

Acessamos o painel do Cloudflare.

Ativamos o Proxy (Nuvem Laranja) para o domÃ­nio do Chatwoot/API.

Ajustamos as regras de SeguranÃ§a/WAF para permitir que os IPs e robÃ´s da Meta passassem pela proteÃ§Ã£o.
Resultado: Assim que o proxy e as regras foram ajustados, a fila da Meta destravou e todas as mensagens atrasadas inundaram a caixa de entrada do Chatwoot instantaneamente.

Dica: Se vocÃª estÃ¡ com mensagens atrasadas, tente usar o Depurador de Compartilhamento da Meta (Facebook Developers) no seu link de webhook ou PolÃ­tica de Privacidade. Se retornar HTTP 418 ou 428, seu firewall/Cloudflare estÃ¡ bloqueando os webhooks!

GraÃ§as a Deus. Todas as mensagens chegam na hora agora. ğŸ™ğŸ™ğŸ™

--- Comment by luanstartflow ---
@git100-br obrigado, acho que os prÃ³ximos cliente vou ter que sair da hostinger, ja enfrentei um problema de mÃ­dia com eles, ultimamente comeÃ§ou a ter muitos problemas. 

--- Comment by git100-br ---
Ativa o Proxy da cloudflare. O firewall da Hostinger que bloqueou por seguranÃ§a. Quando o DNS estÃ¡ pela cloudflare funcionou bem. Isso foi um problema recente. Eu nÃ£o usava o Proxy e funcionava bem.

--- Comment by lennon3d ---
> ### **TÃ­tulo:** [SoluÃ§Ã£o] Mensagens da API WhatsApp Cloud atrasadas por horas ou perdidas (Erro Cloudflare WAF 418/428)
> O Problema: EstÃ¡vamos enfrentando problemas graves com os webhooks da WhatsApp Cloud API. As mensagens estavam chegando com horas de atraso. Inicialmente, suspeitamos dos filas do Sidekiq do Chatwoot, latÃªncia do AWS S3, limites de requisiÃ§Ã£o do Rack::Attack ou instabilidade global na API da Meta. O ambiente do servidor (VPS Hostinger) estava perfeito e as filas do Sidekiq estavam vazias.
> 
> A Causa Raiz: O problema estava totalmente fora do cÃ³digo do Chatwoot. Foi um bloqueio silencioso pelo WAF (Web Application Firewall) do Cloudflare na porta de entrada do servidor. A proteÃ§Ã£o contra bots do Cloudflare estava identificando as requisiÃ§Ãµes de webhook da Meta (e os robÃ´s de leitura da Meta) como trÃ¡fego estrangeiro suspeito, bloqueando-os com erros HTTP 418 / 428. Como o Chatwoot nunca recebeu a requisiÃ§Ã£o para devolver o 200 OK, os servidores da Meta colocavam os webhooks na "Fila de Tentativas" (Exponential Backoff), fazendo com que as mensagens fossem entregues depois de horas.
> 
> A:
> 
> Acessamos o painel do Cloudflare.
> 
> Ativamos o Proxy (Nova Laranja) para o domÃ­nio do Chatwoot/API.
> 
> Ajustamos as regras de SeguranÃ§a/WAF para permitir que os IPs e robÃ´s da Meta passem pela proteÃ§Ã£o. Resultado: Assim que o proxy e as regras foram ajustadas, a fila da Meta destravou e todas as mensagens atrasadas inundaram a caixa de entrada do Chatwoot instantaneamente.
> 
> Dica: Se vocÃª estÃ¡ com mensagens atrasadas, tente usar o Depurador de Compartilhamento da Meta (Facebook Developers) no seu link de webhook ou PolÃ­tica de Privacidade. Se retornar HTTP 418 ou 428, seu firewall/Cloudflare estÃ¡ bloqueando os webhooks!
> 
> GraÃ§as a Deus. Todas as mensagens chegam na hora agora. ğŸ™ğŸ™ğŸ™

Perfect, my friend, you solved my problem. Using Hostinger with EasyPanel, I noticed the same thing was happening and I was going crazy because we were receiving 1000 to 3000 messages, all of which were getting out of order or not being sent. It was madness. Putting all the webhook communication and access directly through Cloudflare solved the problem. Now we just hope it doesn't keep dropping, haha.

--- Comment by joaogehlen91 ---
> ### **TÃ­tulo:** [SoluÃ§Ã£o] Mensagens da WhatsApp Cloud API atrasadas por horas ou perdidas (Erro Cloudflare WAF 418/428)
> O Problema: EstÃ¡vamos enfrentando problemas graves com os webhooks da WhatsApp Cloud API. As mensagens estavam chegando com horas de atraso. Inicialmente, suspeitamos das filas do Sidekiq do Chatwoot, latÃªncia do AWS S3, limites de requisiÃ§Ã£o do Rack::Attack ou instabilidade global na API da Meta. O ambiente do servidor (VPS Hostinger) estava perfeito e as filas do Sidekiq estavam vazias.
> 
> A Causa Raiz: O problema estava totalmente fora do cÃ³digo do Chatwoot. Foi um bloqueio silencioso pelo WAF (Web Application Firewall) do Cloudflare na porta de entrada do servidor. A proteÃ§Ã£o contra bots do Cloudflare estava identificando as requisiÃ§Ãµes de webhook da Meta (e os robÃ´s de leitura da Meta) como trÃ¡fego estrangeiro suspeito, bloqueando-os com erros HTTP 418 / 428. Como o Chatwoot nunca recebia a requisiÃ§Ã£o para devolver o 200 OK, os servidores da Meta colocavam os webhooks na "Fila de Tentativas" (Exponential Backoff), fazendo com que as mensagens fossem entregues horas depois.
> 
> A SoluÃ§Ã£o:
> 
> Acessamos o painel do Cloudflare.
> 
> Ativamos o Proxy (Nuvem Laranja) para o domÃ­nio do Chatwoot/API.
> 
> Ajustamos as regras de SeguranÃ§a/WAF para permitir que os IPs e robÃ´s da Meta passassem pela proteÃ§Ã£o. Resultado: Assim que o proxy e as regras foram ajustados, a fila da Meta destravou e todas as mensagens atrasadas inundaram a caixa de entrada do Chatwoot instantaneamente.
> 
> Dica: Se vocÃª estÃ¡ com mensagens atrasadas, tente usar o Depurador de Compartilhamento da Meta (Facebook Developers) no seu link de webhook ou PolÃ­tica de Privacidade. Se retornar HTTP 418 ou 428, seu firewall/Cloudflare estÃ¡ bloqueando os webhooks!
> 
> GraÃ§as a Deus. Todas as mensagens chegam na hora agora. ğŸ™ğŸ™ğŸ™

"Ajustamos as regras de SeguranÃ§a/WAF para permitir que os IPs e robÃ´s da Meta passassem pela proteÃ§Ã£o" Como exatamente fez isso?

--- Comment by git100-br ---
@joaogehlen91 Eu apenas ativei o proxy da cloudflare para o domÃ­nio do meu chatwoot. 

Minha hospedagem estava bloqueando diversos webhook que a meta me enviava e aÃ­ tentava enviar mais tarde e com isso gerava atrasos de horas na entrega de diversas mensagens. Eu jÃ¡ usava a cloudflare para direcionar meu domÃ­nio para a hospedagem, mas usava apenas para DNS. Quando ativei a nuvem laranja o problema acabou.

--- Comment by luanstartflow ---
@git100-br vocÃª ativou somente a nuvem laranja nada a mais?

--- Comment by sojan-official ---
Weâ€™re seeing similar reports from other self-hosted deployments as well.

To avoid fragmentation and track this properly, weâ€™re consolidating all related findings and updates under this issue.

